<!-- AdminFormatos.html — Módulo Gestor de Formatos por Empresa -->
<div class="space-y-5 animate-fade-in">

    <!-- ── CABECERA ───────────────────────────────────────────────── -->
    <div class="flex items-center justify-between pb-4 border-b border-white/10">
        <div class="flex items-center gap-3">
            <button onclick="volverAlPortalAdmin()"
                class="w-8 h-8 rounded-lg bg-white/5 flex items-center justify-center text-slate-400 hover:bg-white/10 transition border border-white/10 shrink-0"
                title="Volver al portal">
                <span class="material-symbols-outlined text-base">arrow_back</span>
            </button>
            <div>
                <h3 class="text-sm font-black text-white uppercase tracking-tight">Gestor de Formatos</h3>
                <p class="text-[9px] text-slate-500 font-bold uppercase tracking-widest mt-0.5">LISTAS_FORMATOS · Por Empresa Contratista</p>
            </div>
        </div>
        <div class="flex items-center gap-2 shrink-0">
            <button onclick="cargarFormatosAdmin()" title="Recargar datos"
                class="w-9 h-9 flex items-center justify-center rounded-xl bg-white/5 border border-white/10 text-slate-400 hover:bg-white/10 hover:text-white transition-all active:scale-95">
                <span class="material-symbols-outlined text-base">refresh</span>
            </button>
            <button onclick="abrirModalFormato(null)"
                style="background:rgba(197,160,72,0.12); border:1.5px solid rgba(197,160,72,0.35);"
                class="flex items-center gap-1.5 px-4 py-2.5 rounded-xl text-primary font-black text-[10px] uppercase tracking-widest hover:opacity-80 transition-all active:scale-95">
                <span class="material-symbols-outlined text-base">add_circle</span>
                <span class="hidden sm:inline">Nuevo Formato</span>
                <span class="sm:hidden">Nuevo</span>
            </button>
        </div>
    </div>

    <!-- ── TARJETAS DE ESTADÍSTICAS ──────────────────────────────── -->
    <div class="grid grid-cols-2 sm:grid-cols-4 gap-3">
        <div id="fmt-stat-total"
            class="bg-white/5 rounded-xl border border-white/10 p-3 text-center hover:bg-white/8 transition-all">
            <p class="stat-num text-2xl font-black text-white leading-none">-</p>
            <p class="text-[9px] text-slate-500 font-bold uppercase tracking-widest mt-1">Total</p>
        </div>
        <div id="fmt-stat-empresas"
            class="bg-primary/5 rounded-xl border border-primary/20 p-3 text-center hover:bg-primary/8 transition-all">
            <p class="stat-num text-2xl font-black text-primary leading-none">-</p>
            <p class="text-[9px] text-primary/60 font-bold uppercase tracking-widest mt-1">Empresas</p>
        </div>
        <div id="fmt-stat-permisos"
            class="bg-amber-500/5 rounded-xl border border-amber-500/20 p-3 text-center hover:bg-amber-500/8 transition-all">
            <p class="stat-num text-2xl font-black text-amber-400 leading-none">-</p>
            <p class="text-[9px] text-amber-600 font-bold uppercase tracking-widest mt-1">Permisos</p>
        </div>
        <div id="fmt-stat-inspecciones"
            class="bg-blue-500/5 rounded-xl border border-blue-500/20 p-3 text-center hover:bg-blue-500/8 transition-all">
            <p class="stat-num text-2xl font-black text-blue-400 leading-none">-</p>
            <p class="text-[9px] text-blue-600 font-bold uppercase tracking-widest mt-1">Inspecciones</p>
        </div>
    </div>

    <!-- ── FILTROS ────────────────────────────────────────────────── -->
    <div class="flex flex-col sm:flex-row gap-2">
        <!-- Búsqueda por código o descripción -->
        <div class="relative flex-1">
            <span class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-slate-500 text-base pointer-events-none z-10">search</span>
            <input type="text" id="fmt-filtro-texto"
                placeholder="Buscar por código o descripción..."
                oninput="filtrarFormatos()"
                style="background:#1a242f; color:#f8fafc; color-scheme:dark;"
                class="w-full pl-9 pr-3 py-2.5 text-xs font-medium border border-white/10 rounded-xl outline-none focus:border-primary/50 transition-all">
        </div>
        <!-- Selector de empresa -->
        <div class="relative shrink-0 min-w-[185px]">
            <span class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-slate-500 text-base pointer-events-none z-10">location_city</span>
            <select id="fmt-filtro-empresa" onchange="filtrarFormatos()"
                style="background:#1a242f; color:#f8fafc; color-scheme:dark;"
                class="w-full pl-9 pr-3 py-2.5 text-xs font-medium border border-white/10 rounded-xl outline-none focus:border-primary/50 transition-all appearance-none cursor-pointer">
                <option value="" style="background:#1a242f;">Todas las empresas</option>
            </select>
        </div>
        <!-- Selector de tipo -->
        <div class="relative shrink-0 min-w-[155px]">
            <span class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-slate-500 text-base pointer-events-none z-10">label</span>
            <select id="fmt-filtro-tipo" onchange="filtrarFormatos()"
                style="background:#1a242f; color:#f8fafc; color-scheme:dark;"
                class="w-full pl-9 pr-3 py-2.5 text-xs font-medium border border-white/10 rounded-xl outline-none focus:border-primary/50 transition-all appearance-none cursor-pointer">
                <option value="" style="background:#1a242f;">Todos los tipos</option>
                <option value="Registro" style="background:#1a242f;">Registro</option>
                <option value="Permiso" style="background:#1a242f;">Permiso</option>
                <option value="Inspeccion" style="background:#1a242f;">Inspección</option>
                <option value="Ejecucion" style="background:#1a242f;">Ejecución</option>
            </select>
        </div>
    </div>

    <!-- ── VISTA MÓVIL: TARJETAS ─────────────────────────────────── -->
    <div id="fmt-lista-mobile" class="sm:hidden space-y-3">
        <div class="flex flex-col items-center gap-2 py-8 text-slate-500 text-xs italic">
            <div class="animate-spin h-6 w-6 border-2 border-primary/30 border-t-primary rounded-full"></div>
            <span>Cargando formatos...</span>
        </div>
    </div>

    <!-- ── VISTA ESCRITORIO: TABLA ───────────────────────────────── -->
    <div class="hidden sm:block overflow-x-auto rounded-xl border border-white/10 shadow-xl">
        <table class="w-full min-w-[680px] text-left">
            <thead>
                <tr style="background:rgba(255,255,255,0.04);" class="border-b border-white/10">
                    <th class="px-3 py-3 text-[9px] font-black text-slate-400 uppercase tracking-widest whitespace-nowrap">Código</th>
                    <th class="px-3 py-3 text-[9px] font-black text-slate-400 uppercase tracking-widest whitespace-nowrap">Descripción</th>
                    <th class="px-3 py-3 text-[9px] font-black text-slate-400 uppercase tracking-widest whitespace-nowrap">Tipo</th>
                    <th class="px-3 py-3 text-[9px] font-black text-slate-400 uppercase tracking-widest whitespace-nowrap">Empresa</th>
                    <th class="px-3 py-3 text-[9px] font-black text-slate-400 uppercase tracking-widest whitespace-nowrap text-right">Acciones</th>
                </tr>
            </thead>
            <tbody id="fmt-tabla-body">
                <tr>
                    <td colspan="5" class="text-center py-10 text-slate-500 text-xs italic">
                        <div class="flex flex-col items-center gap-2">
                            <div class="animate-spin h-6 w-6 border-2 border-primary/30 border-t-primary rounded-full"></div>
                            <span>Cargando formatos...</span>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- ══════════════════════════════════════════════════════════ -->
<!-- MODAL: CREAR / EDITAR FORMATO                             -->
<!-- ══════════════════════════════════════════════════════════ -->
<div id="fmt-modal"
    style="display:none; position:absolute; z-index:70; left:0; background:rgba(0,0,0,0.85); backdrop-filter:blur(8px);"
    onclick="if(event.target===this) cerrarModalFormato()">

    <!-- Contenedor principal del modal -->
    <div id="fmt-modal-box" class="rounded-2xl border border-white/10 shadow-2xl"
        style="background:#0f1923; display:flex; flex-direction:column; width:92%; max-width:380px; margin:auto;">

        <!-- ── Cabecera ── -->
        <div class="flex items-center gap-3 px-5 py-4 border-b border-white/8 shrink-0"
            style="background:linear-gradient(135deg,rgba(197,160,72,0.08) 0%,transparent 60%);">
            <div class="w-9 h-9 rounded-xl flex items-center justify-center shrink-0 border border-white/10"
                style="background:rgba(197,160,72,0.12);">
                <span class="material-symbols-outlined text-xl" style="color:var(--color-primario)">description</span>
            </div>
            <div class="flex-1 min-w-0">
                <h3 id="fmt-modal-titulo" class="text-sm font-black text-white tracking-tight truncate">Nuevo Formato</h3>
                <p id="fmt-modal-sub" class="text-[10px] text-slate-400 font-bold uppercase tracking-widest truncate"></p>
            </div>
            <button onclick="cerrarModalFormato()"
                class="w-7 h-7 rounded-lg flex items-center justify-center text-slate-500 hover:text-white hover:bg-white/8 transition shrink-0">
                <span class="material-symbols-outlined text-base">close</span>
            </button>
        </div>

        <!-- ── Cuerpo (scrollable) ── -->
        <div style="overflow-y:auto; flex:1; min-height:0; padding:1.25rem 1.25rem; display:flex; flex-direction:column; gap:1rem;">

            <!-- Código -->
            <div>
                <label class="flex items-center gap-1.5 text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-2">
                    <span class="material-symbols-outlined text-xs" style="color:var(--color-primario)">tag</span>
                    Código Formato <span class="text-red-400">*</span>
                </label>
                <input type="text" id="fmt-inp-id" placeholder="Ej: ATS, PMA, IHM..."
                    style="background:#1a2535; color:#f8fafc; color-scheme:dark;"
                    class="w-full px-3 py-2.5 text-sm font-medium border border-white/10 rounded-xl outline-none focus:border-amber-500/50 transition-all placeholder:text-slate-600">
                <p id="fmt-nota-id" class="text-[9px] text-slate-600 mt-1.5 hidden">Puede modificar el código si hubo un error al crearlo.</p>
            </div>

            <!-- Descripción -->
            <div>
                <label class="flex items-center gap-1.5 text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-2">
                    <span class="material-symbols-outlined text-xs" style="color:var(--color-primario)">subject</span>
                    Descripción <span class="text-red-400">*</span>
                </label>
                <input type="text" id="fmt-inp-descripcion" placeholder="Ej: Análisis de Trabajo Seguro"
                    style="background:#1a2535; color:#f8fafc; color-scheme:dark;"
                    class="w-full px-3 py-2.5 text-sm font-medium border border-white/10 rounded-xl outline-none focus:border-amber-500/50 transition-all placeholder:text-slate-600">
            </div>

            <!-- Tipo de Documento -->
            <div>
                <label class="flex items-center gap-1.5 text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-2">
                    <span class="material-symbols-outlined text-xs" style="color:var(--color-primario)">category</span>
                    Tipo de Documento <span class="text-red-400">*</span>
                </label>
                <select id="fmt-inp-tipo"
                    style="background:#1a2535; color:#f8fafc; color-scheme:dark;"
                    class="w-full px-3 py-2.5 text-sm font-medium border border-white/10 rounded-xl outline-none focus:border-amber-500/50 transition-all appearance-none cursor-pointer">
                    <option value="" style="background:#1a2535;">Seleccione el tipo...</option>
                    <option value="Registro" style="background:#1a2535;">Registro</option>
                    <option value="Permiso" style="background:#1a2535;">Permiso</option>
                    <option value="Inspeccion" style="background:#1a2535;">Inspección</option>
                    <option value="Ejecucion" style="background:#1a2535;">Ejecución</option>
                </select>
            </div>

            <!-- Empresa Contratista -->
            <div>
                <label class="flex items-center gap-1.5 text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-2">
                    <span class="material-symbols-outlined text-xs" style="color:var(--color-primario)">location_city</span>
                    Empresa Contratista <span class="text-red-400">*</span>
                </label>
                <!-- Modo CREAR -->
                <select id="fmt-inp-empresa"
                    style="background:#1a2535; color:#f8fafc; color-scheme:dark;"
                    class="w-full px-3 py-2.5 text-sm font-medium border border-white/10 rounded-xl outline-none focus:border-amber-500/50 transition-all appearance-none cursor-pointer">
                    <option value="" style="background:#1a2535;">Seleccione la empresa...</option>
                </select>
                <!-- Modo EDITAR: texto fijo -->
                <div id="fmt-empresa-display" style="display:none; background:#1a2535;"
                    class="px-3 py-2.5 rounded-xl border border-amber-500/20">
                    <div class="flex items-center gap-2">
                        <span class="material-symbols-outlined text-sm text-amber-500/60">lock</span>
                        <span id="fmt-empresa-texto" class="text-sm font-bold text-white flex-1"></span>
                        <span class="text-[9px] font-bold uppercase tracking-widest px-1.5 py-0.5 rounded"
                            style="color:rgba(197,160,72,0.7); background:rgba(197,160,72,0.08); border:1px solid rgba(197,160,72,0.2)">Fijo</span>
                    </div>
                    <p class="text-[9px] text-slate-600 mt-1">Para cambiarla, elimine el formato y créelo de nuevo.</p>
                </div>
            </div>
        </div>

        <!-- ── Footer ── -->
        <div class="px-5 py-4 flex gap-3 border-t border-white/8 shrink-0" style="background:#0d1720;">
            <button onclick="cerrarModalFormato()"
                class="flex-1 py-2.5 text-slate-400 font-bold hover:bg-white/5 rounded-xl transition text-xs uppercase tracking-widest border border-white/10">
                Cancelar
            </button>
            <button onclick="guardarFormato()" id="fmt-btn-guardar"
                style="background:var(--color-primario); box-shadow:0 4px 14px rgba(197,160,72,0.3);"
                class="flex-1 py-2.5 text-black font-black rounded-xl transition-all active:scale-95 flex items-center justify-center gap-2 text-xs uppercase tracking-widest">
                <span id="fmt-spinner-guardar" class="hidden animate-spin border-2 border-black border-t-transparent rounded-full w-3.5 h-3.5"></span>
                <span class="material-symbols-outlined text-sm">save</span>
                Guardar
            </button>
        </div>
    </div>
</div>
