<!-- AdminFormatos.html — Módulo Gestor de Formatos por Empresa -->
<div class="space-y-5 animate-fade-in">

    <!-- ── CABECERA ───────────────────────────────────────────────── -->
    <div class="flex items-center justify-between pb-4 border-b border-white/10">
        <div class="flex items-center gap-3">
            <button onclick="volverAlPortalAdmin()"
                class="w-8 h-8 rounded-lg bg-white/5 flex items-center justify-center text-slate-400 hover:bg-white/10 transition border border-white/10 shrink-0"
                title="Volver al portal">
                <span class="material-symbols-outlined text-base">arrow_back</span>
            </button>
            <div>
                <h3 class="text-sm font-black text-white uppercase tracking-tight">Gestor de Formatos</h3>
                <p class="text-[9px] text-slate-500 font-bold uppercase tracking-widest mt-0.5">LISTAS_FORMATOS · Por Empresa Contratista</p>
            </div>
        </div>
        <button onclick="abrirModalFormato(null)"
            style="background:rgba(197,160,72,0.12); border:1.5px solid rgba(197,160,72,0.35);"
            class="flex items-center gap-1.5 px-4 py-2.5 rounded-xl text-primary font-black text-[10px] uppercase tracking-widest hover:opacity-80 transition-all active:scale-95 shrink-0">
            <span class="material-symbols-outlined text-base">add_circle</span>
            <span class="hidden sm:inline">Nuevo Formato</span>
            <span class="sm:hidden">Nuevo</span>
        </button>
    </div>

    <!-- ── TARJETAS DE ESTADÍSTICAS ──────────────────────────────── -->
    <div class="grid grid-cols-2 sm:grid-cols-4 gap-3">
        <div id="fmt-stat-total"
            class="bg-white/5 rounded-xl border border-white/10 p-3 text-center hover:bg-white/8 transition-all">
            <p class="stat-num text-2xl font-black text-white leading-none">-</p>
            <p class="text-[9px] text-slate-500 font-bold uppercase tracking-widest mt-1">Total</p>
        </div>
        <div id="fmt-stat-empresas"
            class="bg-primary/5 rounded-xl border border-primary/20 p-3 text-center hover:bg-primary/8 transition-all">
            <p class="stat-num text-2xl font-black text-primary leading-none">-</p>
            <p class="text-[9px] text-primary/60 font-bold uppercase tracking-widest mt-1">Empresas</p>
        </div>
        <div id="fmt-stat-permisos"
            class="bg-amber-500/5 rounded-xl border border-amber-500/20 p-3 text-center hover:bg-amber-500/8 transition-all">
            <p class="stat-num text-2xl font-black text-amber-400 leading-none">-</p>
            <p class="text-[9px] text-amber-600 font-bold uppercase tracking-widest mt-1">Permisos</p>
        </div>
        <div id="fmt-stat-inspecciones"
            class="bg-blue-500/5 rounded-xl border border-blue-500/20 p-3 text-center hover:bg-blue-500/8 transition-all">
            <p class="stat-num text-2xl font-black text-blue-400 leading-none">-</p>
            <p class="text-[9px] text-blue-600 font-bold uppercase tracking-widest mt-1">Inspecciones</p>
        </div>
    </div>

    <!-- ── FILTROS ────────────────────────────────────────────────── -->
    <div class="flex flex-col sm:flex-row gap-2">
        <!-- Búsqueda por código o descripción -->
        <div class="relative flex-1">
            <span class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-slate-500 text-base pointer-events-none z-10">search</span>
            <input type="text" id="fmt-filtro-texto"
                placeholder="Buscar por código o descripción..."
                oninput="filtrarFormatos()"
                style="background:#1a242f; color:#f8fafc; color-scheme:dark;"
                class="w-full pl-9 pr-3 py-2.5 text-xs font-medium border border-white/10 rounded-xl outline-none focus:border-primary/50 transition-all">
        </div>
        <!-- Selector de empresa -->
        <div class="relative shrink-0 min-w-[185px]">
            <span class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-slate-500 text-base pointer-events-none z-10">location_city</span>
            <select id="fmt-filtro-empresa" onchange="filtrarFormatos()"
                style="background:#1a242f; color:#f8fafc; color-scheme:dark;"
                class="w-full pl-9 pr-3 py-2.5 text-xs font-medium border border-white/10 rounded-xl outline-none focus:border-primary/50 transition-all appearance-none cursor-pointer">
                <option value="" style="background:#1a242f;">Todas las empresas</option>
            </select>
        </div>
        <!-- Selector de tipo -->
        <div class="relative shrink-0 min-w-[155px]">
            <span class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-slate-500 text-base pointer-events-none z-10">label</span>
            <select id="fmt-filtro-tipo" onchange="filtrarFormatos()"
                style="background:#1a242f; color:#f8fafc; color-scheme:dark;"
                class="w-full pl-9 pr-3 py-2.5 text-xs font-medium border border-white/10 rounded-xl outline-none focus:border-primary/50 transition-all appearance-none cursor-pointer">
                <option value="" style="background:#1a242f;">Todos los tipos</option>
                <option value="Registro" style="background:#1a242f;">Registro</option>
                <option value="Permiso" style="background:#1a242f;">Permiso</option>
                <option value="Inspeccion" style="background:#1a242f;">Inspección</option>
                <option value="Ejecucion" style="background:#1a242f;">Ejecución</option>
            </select>
        </div>
    </div>

    <!-- ── VISTA MÓVIL: TARJETAS ─────────────────────────────────── -->
    <div id="fmt-lista-mobile" class="sm:hidden space-y-3">
        <div class="flex flex-col items-center gap-2 py-8 text-slate-500 text-xs italic">
            <div class="animate-spin h-6 w-6 border-2 border-primary/30 border-t-primary rounded-full"></div>
            <span>Cargando formatos...</span>
        </div>
    </div>

    <!-- ── VISTA ESCRITORIO: TABLA ───────────────────────────────── -->
    <div class="hidden sm:block overflow-x-auto rounded-xl border border-white/10 shadow-xl">
        <table class="w-full min-w-[680px] text-left">
            <thead>
                <tr style="background:rgba(255,255,255,0.04);" class="border-b border-white/10">
                    <th class="px-3 py-3 text-[9px] font-black text-slate-400 uppercase tracking-widest whitespace-nowrap">Código</th>
                    <th class="px-3 py-3 text-[9px] font-black text-slate-400 uppercase tracking-widest whitespace-nowrap">Descripción</th>
                    <th class="px-3 py-3 text-[9px] font-black text-slate-400 uppercase tracking-widest whitespace-nowrap">Tipo</th>
                    <th class="px-3 py-3 text-[9px] font-black text-slate-400 uppercase tracking-widest whitespace-nowrap">Empresa</th>
                    <th class="px-3 py-3 text-[9px] font-black text-slate-400 uppercase tracking-widest whitespace-nowrap text-right">Acciones</th>
                </tr>
            </thead>
            <tbody id="fmt-tabla-body">
                <tr>
                    <td colspan="5" class="text-center py-10 text-slate-500 text-xs italic">
                        <div class="flex flex-col items-center gap-2">
                            <div class="animate-spin h-6 w-6 border-2 border-primary/30 border-t-primary rounded-full"></div>
                            <span>Cargando formatos...</span>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- ══════════════════════════════════════════════════════════ -->
<!-- MODAL: CREAR / EDITAR FORMATO                             -->
<!-- ══════════════════════════════════════════════════════════ -->
<div id="fmt-modal"
    class="fixed inset-0 bg-black/85 z-[70] flex items-end sm:items-center justify-center hidden backdrop-blur-md"
    onclick="if(event.target===this) cerrarModalFormato()">
    <div class="bg-[#101922] rounded-t-3xl sm:rounded-2xl shadow-2xl w-full sm:max-w-md border border-white/10 animate-slide-up">

        <!-- Handle móvil -->
        <div class="sm:hidden flex justify-center pt-3 pb-1">
            <div class="w-10 h-1 bg-white/20 rounded-full"></div>
        </div>

        <!-- Cabecera modal -->
        <div class="px-6 pt-4 pb-3 border-b border-white/10 flex items-center gap-3">
            <div class="w-10 h-10 bg-primary/10 rounded-xl flex items-center justify-center border border-primary/20 shrink-0">
                <span class="material-symbols-outlined text-2xl text-primary">description</span>
            </div>
            <div>
                <h3 id="fmt-modal-titulo" class="text-base font-black text-white tracking-tight">Nuevo Formato</h3>
                <p id="fmt-modal-sub" class="text-[10px] text-slate-400 font-bold uppercase tracking-widest"></p>
            </div>
        </div>

        <!-- Cuerpo del formulario -->
        <div class="px-6 py-4 space-y-3 overflow-y-auto" style="max-height:60vh;">

            <!-- Código Id_Formato -->
            <div>
                <label class="block text-[10px] font-bold text-slate-300 uppercase tracking-widest mb-1.5">Código Formato *</label>
                <input type="text" id="fmt-inp-id" placeholder="Ej: ATS, PMA, IHM..."
                    style="background:#1a242f; color:#f8fafc; color-scheme:dark;"
                    class="w-full px-3 py-2.5 text-xs border border-white/10 rounded-xl outline-none focus:border-primary/50 transition-all">
                <p id="fmt-nota-id" class="text-[9px] text-slate-500 mt-1">Código corto único para identificar el formato dentro de la empresa.</p>
            </div>

            <!-- Descripción -->
            <div>
                <label class="block text-[10px] font-bold text-slate-300 uppercase tracking-widest mb-1.5">Descripción *</label>
                <input type="text" id="fmt-inp-descripcion" placeholder="Ej: Análisis de Trabajo Seguro"
                    style="background:#1a242f; color:#f8fafc; color-scheme:dark;"
                    class="w-full px-3 py-2.5 text-xs border border-white/10 rounded-xl outline-none focus:border-primary/50 transition-all">
            </div>

            <!-- Tipo de Documento -->
            <div>
                <label class="block text-[10px] font-bold text-slate-300 uppercase tracking-widest mb-1.5">Tipo de Documento *</label>
                <select id="fmt-inp-tipo"
                    style="background:#1a242f; color:#f8fafc; color-scheme:dark;"
                    class="w-full px-3 py-2.5 text-xs border border-white/10 rounded-xl outline-none focus:border-primary/50 transition-all appearance-none">
                    <option value="" style="background:#1a242f;">Seleccione el tipo...</option>
                    <option value="Registro" style="background:#1a242f;">Registro</option>
                    <option value="Permiso" style="background:#1a242f;">Permiso</option>
                    <option value="Inspeccion" style="background:#1a242f;">Inspección</option>
                    <option value="Ejecucion" style="background:#1a242f;">Ejecución</option>
                </select>
            </div>

            <!-- Empresa Contratista -->
            <div>
                <label class="block text-[10px] font-bold text-slate-300 uppercase tracking-widest mb-1.5">Empresa Contratista *</label>
                <select id="fmt-inp-empresa"
                    style="background:#1a242f; color:#f8fafc; color-scheme:dark;"
                    class="w-full px-3 py-2.5 text-xs border border-white/10 rounded-xl outline-none focus:border-primary/50 transition-all appearance-none">
                    <option value="" style="background:#1a242f;">Seleccione la empresa...</option>
                </select>
            </div>
        </div>

        <!-- Footer -->
        <div class="px-6 pb-5 pt-3 flex gap-3 border-t border-white/5">
            <button onclick="cerrarModalFormato()"
                class="flex-1 py-3 text-slate-300 font-bold hover:bg-white/5 rounded-xl transition text-sm border border-white/10">
                Cancelar
            </button>
            <button onclick="guardarFormato()" id="fmt-btn-guardar"
                style="background:var(--color-primario); box-shadow:0 4px 14px rgba(197,160,72,0.25);"
                class="flex-1 py-3 text-black font-black rounded-xl transition-all active:scale-95 flex items-center justify-center gap-2 text-sm uppercase tracking-widest">
                <span id="fmt-spinner-guardar" class="hidden animate-spin border-2 border-black border-t-transparent rounded-full w-4 h-4"></span>
                <span class="material-symbols-outlined text-base">save</span>
                Guardar
            </button>
        </div>
    </div>
</div>
