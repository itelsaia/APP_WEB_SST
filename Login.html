<!DOCTYPE html>
<html class="dark" lang="es">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0, viewport-fit=cover" name="viewport" />
    <title>Login | SaaS SST</title>
    <style>
        :root {
            --color-primario: <?=config.COLOR_PRIMARIO || '#C5A048' ?>;
            --color-acento: <?=config.COLOR_ACENTO || '#D4AF37' ?>;
            --color-fondo: <?=config.COLOR_FONDO || '#101922' ?>;
        }

        *,
        *::before,
        *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            color-scheme: dark;
            height: 100%;
        }

        body {
            background-color: var(--color-fondo);
            font-family: 'Inter', sans-serif;
            min-height: 100dvh;
            height: 100dvh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            /* NO scroll en mobile */
            position: relative;
            color: #f8fafc;
        }

        /* Blobs decorativos */
        .blob {
            position: fixed;
            border-radius: 50%;
            filter: blur(80px);
            pointer-events: none;
            z-index: 0;
        }

        .blob-1 {
            width: 320px;
            height: 320px;
            top: -10%;
            right: -8%;
            background: var(--color-primario);
            opacity: .07;
        }

        .blob-2 {
            width: 240px;
            height: 240px;
            bottom: -8%;
            left: -12%;
            background: var(--color-acento);
            opacity: .05;
        }

        /* Card */
        .glass-panel {
            background: rgba(255, 255, 255, .04);
            backdrop-filter: blur(14px);
            -webkit-backdrop-filter: blur(14px);
            border: 1px solid rgba(255, 255, 255, .08);
            border-radius: 1.25rem;
        }

        /* Inputs */
        .field-dark {
            background: rgba(255, 255, 255, .05);
            border: 1px solid rgba(255, 255, 255, .10);
            color: #f8fafc;
            border-radius: .75rem;
            transition: border-color .2s, box-shadow .2s;
            width: 100%;
            padding: .75rem .75rem .75rem 2.75rem;
            font-size: .9rem;
            font-family: inherit;
        }

        .field-dark:focus {
            outline: none;
            border-color: var(--color-primario);
            box-shadow: 0 0 0 3px rgba(197, 160, 72, .15);
        }

        .field-dark::placeholder {
            color: rgba(248, 250, 252, .35);
        }

        /* Error toast */
        #login-error {
            display: none;
            background: rgba(239, 68, 68, .12);
            border: 1px solid rgba(239, 68, 68, .35);
            border-radius: .75rem;
            padding: .7rem 1rem;
            font-size: .82rem;
            font-weight: 600;
            color: #fca5a5;
            align-items: center;
            gap: .5rem;
        }

        /* Links */
        .link-gold {
            color: var(--color-primario);
            font-weight: 700;
            text-decoration: none;
            transition: opacity .2s;
            font-size: .8rem;
        }

        .link-gold:hover {
            opacity: .75;
            text-decoration: underline;
        }

        /* Animate */
        @keyframes fadeUp {
            from {
                opacity: 0;
                transform: translateY(16px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-in {
            animation: fadeUp .5s ease-out both;
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap"
        rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@400,0&display=swap"
        rel="stylesheet" />
    <?!= include('Styles'); ?>
</head>

<body>
    <div class="blob blob-1"></div>
    <div class="blob blob-2"></div>

    <!-- LOGIN CONTAINER — ancho máx 400px, sin scroll -->
    <div id="login-container" class="relative z-10 w-full animate-in" style="max-width:400px; padding:1.25rem;">

        <!-- Logo + Título -->
        <div style="display:flex; flex-direction:column; align-items:center; margin-bottom:1.2rem; text-align:center;">

            <!-- Logo box 72×72 -->
            <div style="
                width:72px; height:72px; border-radius:1rem; overflow:hidden;
                border:2px solid var(--color-primario);
                background:rgba(255,255,255,.05);
                box-shadow:0 0 32px rgba(197,160,72,.18);
                display:flex; align-items:center; justify-content:center;
                margin-bottom:.9rem; flex-shrink:0;">
                <? var rawLogoUrl = config.URL_LOGO || ''; ?>
                <? var logoValido  = rawLogoUrl && rawLogoUrl.indexOf('placeholder') === -1 && rawLogoUrl.trim() !== ''; ?>
                <? if (logoValido) { ?>
                <?
                        // Extraer file ID para thumbnail (más confiable que uc?export=view)
                        var driveMatch = rawLogoUrl.match(/\/d\/([a-zA-Z0-9_\-]+)/);
                        var driveId    = driveMatch ? driveMatch[1] : null;
                        var thumbUrl   = driveId
                            ? 'https://drive.google.com/thumbnail?id=' + driveId + '&sz=w200'
                            : rawLogoUrl;
                    ?>
                <img id="login-logo" src="<?= thumbUrl ?>" alt="<?= config.NOMBRE_EMPRESA || 'Logo' ?>"
                    style="width:100%; height:100%; object-fit:cover;" data-raw="<?= rawLogoUrl ?>"
                    data-drive-id="<?= driveId || '' ?>" data-retry="0" onerror="(function(img){
                           var id    = img.getAttribute('data-drive-id');
                           var raw   = img.getAttribute('data-raw');
                           var retry = parseInt(img.getAttribute('data-retry')||'0');
                           img.setAttribute('data-retry', retry+1);
                           if (retry===0 && id)       { img.src='https://drive.google.com/uc?export=view&id='+id; }
                           else if (retry===1 && id)  { img.src='https://lh3.googleusercontent.com/d/'+id; }
                           else if (retry===2 && raw) { img.src=raw; }
                           else {
                             img.style.display='none';
                             var fb=document.getElementById('logo-fallback');
                             if(fb){ fb.style.display='flex'; }
                           }
                         })(this);" />
                <span id="logo-fallback" class="material-symbols-outlined"
                    style="color:var(--color-primario); font-size:44px; display:none;">security</span>
                <? } else { ?>
                <span class="material-symbols-outlined"
                    style="color:var(--color-primario); font-size:44px;">security</span>
                <? } ?>
            </div>

            <h1
                style="font-size:1.6rem; font-weight:900; letter-spacing:-.02em; color:#fff; text-transform:uppercase; margin-bottom:.3rem;">
                GESTION STT</h1>
            <p style="font-size:.82rem; color:rgba(248,250,252,.55); font-weight:500;">
                Inicie sesión para acceder a
                <span style="color:var(--color-primario); font-weight:800;">
                    <?= config.NOMBRE_EMPRESA || 'SECURITY WORK S&M' ?>
                </span>
            </p>
        </div>

        <!-- Form card -->
        <div class="glass-panel" style="padding:1.4rem;">
            <form id="login-form" style="display:flex; flex-direction:column; gap:.9rem;">

                <!-- Error toast (oculto por defecto) -->
                <div id="login-error"
                    style="display:none; background:rgba(239,68,68,.12); border:1px solid rgba(239,68,68,.35); border-radius:.75rem; padding:.6rem .9rem; font-size:.82rem; font-weight:600; color:#fca5a5; align-items:center; gap:.5rem;">
                    <span class="material-symbols-outlined" style="font-size:18px; flex-shrink:0;">error</span>
                    <span id="login-error-msg">Error</span>
                </div>

                <!-- Email -->
                <div>
                    <label
                        style="font-size:.7rem; font-weight:700; text-transform:uppercase; letter-spacing:.08em; color:var(--color-primario); opacity:.85; display:block; margin-bottom:.4rem;"
                        for="email">Correo electrónico</label>
                    <div style="position:relative;">
                        <span class="material-symbols-outlined"
                            style="position:absolute; left:.75rem; top:50%; transform:translateY(-50%); font-size:18px; color:var(--color-primario); opacity:.7; pointer-events:none;">mail</span>
                        <input type="email" id="email" required autocomplete="email" placeholder="usuario@ejemplo.com"
                            class="field-dark" />
                    </div>
                </div>

                <!-- Password -->
                <div>
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:.4rem;">
                        <label
                            style="font-size:.7rem; font-weight:700; text-transform:uppercase; letter-spacing:.08em; color:var(--color-primario); opacity:.85;"
                            for="password">Contraseña</label>
                        <a href="#" class="link-gold" style="opacity:.7;">¿Olvidaste tu contraseña?</a>
                    </div>
                    <div style="position:relative;">
                        <span class="material-symbols-outlined"
                            style="position:absolute; left:.75rem; top:50%; transform:translateY(-50%); font-size:18px; color:var(--color-primario); opacity:.7; pointer-events:none;">lock</span>
                        <input type="password" id="password" required autocomplete="current-password"
                            placeholder="••••••••" class="field-dark" style="padding-right:3rem;" />
                        <button type="button" onclick="togglePassword()"
                            style="position:absolute; right:.75rem; top:50%; transform:translateY(-50%); background:none; border:none; cursor:pointer; color:var(--color-primario); display:flex; align-items:center;">
                            <span class="material-symbols-outlined" id="eye-icon"
                                style="font-size:18px;">visibility_off</span>
                        </button>
                    </div>
                </div>

                <!-- Submit -->
                <button type="submit" id="btn-login"
                    style="background:var(--color-primario); box-shadow:0 6px 24px rgba(197,160,72,.30); color:#000; border:none; border-radius:.75rem; padding:.9rem; font-size:.9rem; font-weight:900; text-transform:uppercase; letter-spacing:.1em; cursor:pointer; display:flex; justify-content:center; align-items:center; gap:.5rem; width:100%; transition:opacity .2s, transform .1s; margin-top:.15rem;">
                    <span id="login-spinner" class="hidden animate-spin"
                        style="border:2px solid #000; border-top-color:transparent; border-radius:50%; width:18px; height:18px;"></span>
                    <span class="material-symbols-outlined" style="font-size:20px;">login</span>
                    <span id="btn-text">INICIAR SESIÓN</span>
                </button>
            </form>
        </div>

        <!-- Registrar / Footer -->
        <div style="text-align:center; margin-top:.9rem;">
            <p style="font-size:.8rem; color:rgba(248,250,252,.45);">
                ¿No tienes una cuenta?
                <a href="#" onclick="showRegister()" class="link-gold" style="margin-left:4px;">Regístrate</a>
            </p>
            <p
                style="font-size:.65rem; letter-spacing:.12em; color:rgba(248,250,252,.2); text-transform:uppercase; font-weight:700; margin-top:.5rem;">
                Desarrollado por ITELSA IA</p>
        </div>
    </div>

    <script>
        var SCRIPT_URL = '<?= scriptUrl || "" ?>';
    </script>
    <?!= include('Login.js'); ?>
</body>

</html>