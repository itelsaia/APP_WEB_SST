<!-- AdminHallazgos.html — Módulo 6: Galería de Gestión de Hallazgos SST -->
<div class="space-y-5 animate-fade-in">

    <style>
        /* ── Card ─────────────────────────────────────────────────────────── */
        .gh-card {
            border-radius: 18px;
            overflow: hidden;
            background: #111c27;
            border: 1.5px solid rgba(255,255,255,0.08);
            transition: transform .18s, box-shadow .18s, border-color .18s;
            cursor: pointer;
            display: flex;
            flex-direction: column;
        }
        .gh-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 48px rgba(0,0,0,0.55);
            border-color: rgba(197,160,72,0.22);
        }
        .gh-card:active { transform: scale(.97); }

        /* Zona de foto */
        .gh-foto-wrap {
            position: relative;
            flex-shrink: 0;
            height: 170px;
            background: #0d1821;
            overflow: hidden;
        }
        .gh-foto {
            width: 100%; height: 100%;
            object-fit: cover;
            display: block;
            transition: transform .35s ease;
        }
        .gh-card:hover .gh-foto { transform: scale(1.04); }
        .gh-foto-placeholder {
            width: 100%; height: 100%;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            gap: 8px; color: rgba(255,255,255,0.18);
            background: linear-gradient(135deg, #0d1821, #152030);
        }

        /* Badge estado */
        .gh-badge {
            position: absolute; top: 10px; right: 10px; z-index: 5;
            font-size: 9px; font-weight: 900; letter-spacing: .12em;
            padding: 4px 10px; border-radius: 999px;
            text-transform: uppercase;
            backdrop-filter: blur(8px);
        }
        .gh-badge-abierto {
            background: rgba(220,38,38,0.88);
            border: 1px solid rgba(248,113,113,0.45);
            color: #fff;
        }
        .gh-badge-cerrado {
            background: rgba(22,163,74,0.88);
            border: 1px solid rgba(74,222,128,0.45);
            color: #fff;
        }

        /* Mini tabs Antes/Después (solo CERRADO) */
        .gh-tabs-wrap {
            position: absolute; bottom: 8px; left: 10px; z-index: 5;
            display: flex; gap: 4px;
        }
        .gh-tab-btn {
            font-size: 9px; font-weight: 900; letter-spacing: .08em;
            text-transform: uppercase;
            padding: 3px 9px; border-radius: 7px;
            border: 1px solid rgba(255,255,255,0.20);
            color: rgba(255,255,255,0.55);
            background: rgba(10,18,28,0.70);
            backdrop-filter: blur(6px);
            cursor: pointer; transition: all .15s;
        }
        .gh-tab-btn.active {
            background: rgba(197,160,72,0.85);
            border-color: rgba(197,160,72,0.9);
            color: #0d1821;
        }

        /* Panel de información (debajo de la foto, fondo sólido) */
        .gh-info {
            padding: 14px 14px 12px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            flex: 1;
            border-top: 1px solid rgba(255,255,255,0.06);
        }
        .gh-desc {
            font-size: 12px;
            font-weight: 700;
            color: #f1f5f9;
            line-height: 1.45;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        .gh-meta-row {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 10px;
            color: #64748b;
            font-weight: 600;
        }
        .gh-meta-icon {
            font-size: 13px !important;
            line-height: 1 !important;
            flex-shrink: 0;
        }
        .gh-meta-val {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .gh-gestion-row {
            font-size: 10px;
            color: #4ade80;
            font-weight: 600;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            line-height: 1.4;
        }
        .gh-footer-row {
            font-size: 9px;
            color: rgba(100,116,139,0.7);
            font-weight: 700;
            letter-spacing: .04em;
            text-transform: uppercase;
            margin-top: 2px;
        }
        .gh-ver-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            padding: 8px;
            border-radius: 10px;
            background: rgba(197,160,72,0.07);
            border: 1px solid rgba(197,160,72,0.18);
            color: rgba(197,160,72,0.8);
            font-size: 10px;
            font-weight: 900;
            letter-spacing: .08em;
            text-transform: uppercase;
            transition: all .15s;
            margin-top: 4px;
        }
        .gh-card:hover .gh-ver-btn {
            background: rgba(197,160,72,0.14);
            border-color: rgba(197,160,72,0.35);
            color: #C5A048;
        }

        /* Filtro pill */
        .gh-pill {
            font-size: 10px; font-weight: 900; letter-spacing: .08em;
            text-transform: uppercase;
            padding: 6px 14px; border-radius: 999px;
            border: 1.5px solid rgba(255,255,255,0.10);
            color: rgba(255,255,255,0.40);
            background: rgba(255,255,255,0.03);
            cursor: pointer; transition: all .15s; white-space: nowrap;
        }
        .gh-pill.active-todos   { background:rgba(197,160,72,0.14); border-color:rgba(197,160,72,0.45); color:#C5A048; }
        .gh-pill.active-abierto { background:rgba(220,38,38,0.12);  border-color:rgba(220,38,38,0.40);  color:#f87171; }
        .gh-pill.active-cerrado { background:rgba(22,163,74,0.12);  border-color:rgba(22,163,74,0.40);  color:#4ade80; }

        /* Modal detalle */
        #gh-modal-detalle { display: none; }
        #gh-modal-detalle.open { display: flex; }
    </style>

    <!-- ── CABECERA ───────────────────────────────────────────────────── -->
    <div class="flex items-center justify-between pb-4 border-b border-white/10">
        <div class="flex items-center gap-3">
            <button onclick="volverAlPortalAdmin()"
                class="w-8 h-8 rounded-lg bg-white/5 flex items-center justify-center text-slate-400 hover:bg-white/10 transition border border-white/10 shrink-0"
                title="Volver al portal">
                <span class="material-symbols-outlined text-base">arrow_back</span>
            </button>
            <div>
                <h3 class="text-sm font-black text-white uppercase tracking-tight">Gestión Hallazgos</h3>
                <p class="text-[9px] text-primary/60 font-bold uppercase tracking-widest mt-0.5">Galería de Evidencias SST</p>
            </div>
        </div>
        <button onclick="cargarGaleriaHallazgos()" title="Recargar"
            class="w-9 h-9 flex items-center justify-center rounded-xl bg-white/5 border border-white/10 text-slate-400 hover:bg-white/10 hover:text-white transition-all active:scale-95">
            <span class="material-symbols-outlined text-base">refresh</span>
        </button>
    </div>

    <!-- ── LOADER ─────────────────────────────────────────────────────── -->
    <div id="gh-loader" class="flex flex-col items-center gap-3 py-16 text-slate-500">
        <div class="animate-spin rounded-full h-8 w-8 border-2 border-primary/60 border-t-transparent"></div>
        <p class="text-xs font-bold uppercase tracking-widest">Cargando galería...</p>
    </div>

    <!-- ── CONTENIDO ──────────────────────────────────────────────────── -->
    <div id="gh-content" class="hidden space-y-5">

        <!-- KPIs rápidos -->
        <div class="grid grid-cols-3 gap-3">
            <div class="bg-white/5 rounded-xl border border-white/10 p-3 text-center">
                <p id="gh-cnt-total-num" class="text-xl font-black text-white leading-none">-</p>
                <p class="text-[9px] text-slate-500 font-bold uppercase tracking-widest mt-1">Total</p>
            </div>
            <div class="bg-red-500/5 rounded-xl border border-red-500/20 p-3 text-center">
                <p id="gh-cnt-abiertos-num" class="text-xl font-black text-red-400 leading-none">-</p>
                <p class="text-[9px] text-red-600/80 font-bold uppercase tracking-widest mt-1">Abiertos</p>
            </div>
            <div class="bg-green-500/5 rounded-xl border border-green-500/20 p-3 text-center">
                <p id="gh-cnt-cerrados-num" class="text-xl font-black text-green-400 leading-none">-</p>
                <p class="text-[9px] text-green-600/80 font-bold uppercase tracking-widest mt-1">Cerrados</p>
            </div>
        </div>

        <!-- Filtros -->
        <div class="flex flex-col sm:flex-row gap-2">
            <div class="flex items-center gap-2 flex-wrap shrink-0">
                <button class="gh-pill active-todos" onclick="setFiltroEstado('todos', this)">Todos</button>
                <button class="gh-pill" onclick="setFiltroEstado('ABIERTO', this)">Abiertos</button>
                <button class="gh-pill" onclick="setFiltroEstado('CERRADO', this)">Cerrados</button>
            </div>
            <div class="relative flex-1">
                <span class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-slate-500 text-base pointer-events-none">search</span>
                <input type="text" id="gh-filtro-texto"
                    placeholder="Buscar supervisor, empresa, ubicación..."
                    oninput="filtrarGaleriaHallazgos()"
                    style="background:#1a242f; color:#f8fafc; color-scheme:dark;"
                    class="w-full pl-9 pr-3 py-2.5 text-xs font-medium border border-white/10 rounded-xl outline-none focus:border-primary/40 transition-all">
            </div>
        </div>

        <!-- Galería grid -->
        <div id="gh-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>

        <!-- Sin resultados -->
        <div id="gh-empty" class="hidden flex-col items-center gap-3 py-14 text-slate-500">
            <span class="material-symbols-outlined text-4xl">image_search</span>
            <p class="text-xs font-bold text-center">Sin hallazgos para los filtros aplicados</p>
        </div>

    </div>

    <!-- ── ERROR ──────────────────────────────────────────────────────── -->
    <div id="gh-error" class="hidden flex-col items-center gap-3 py-14 text-red-400/70">
        <span class="material-symbols-outlined text-4xl">error_outline</span>
        <p id="gh-error-msg" class="text-xs font-bold text-center max-w-xs">Error al cargar los hallazgos.</p>
        <button onclick="cargarGaleriaHallazgos()"
            class="text-[10px] font-black uppercase tracking-widest px-4 py-2 rounded-xl bg-white/5 border border-white/10 text-slate-300 hover:bg-white/10 transition">
            Reintentar
        </button>
    </div>

    <!-- ═══════════════════════════════════════════════════════════════ -->
    <!-- MODAL DETALLE HALLAZGO                                        -->
    <!-- ═══════════════════════════════════════════════════════════════ -->
    <div id="gh-modal-detalle"
        class="fixed inset-0 bg-black/90 z-[80] flex items-end sm:items-center justify-center backdrop-blur-md"
        onclick="if(event.target===this)cerrarDetalleHallazgo()">
        <div class="bg-[#0d1821] rounded-t-3xl sm:rounded-2xl shadow-2xl w-full sm:max-w-2xl max-h-[92vh] border border-white/10 flex flex-col">

            <!-- Handle móvil -->
            <div class="sm:hidden flex justify-center pt-3 pb-1 shrink-0">
                <div class="w-10 h-1 bg-white/20 rounded-full"></div>
            </div>

            <!-- Header modal -->
            <div class="px-5 pt-4 pb-3 border-b border-white/10 flex items-center justify-between shrink-0">
                <div class="flex items-center gap-3 min-w-0">
                    <div class="w-9 h-9 bg-primary/10 rounded-xl flex items-center justify-center border border-primary/20 shrink-0">
                        <span class="material-symbols-outlined text-xl text-primary">find_in_page</span>
                    </div>
                    <div class="min-w-0">
                        <h3 id="gh-modal-id" class="text-sm font-black text-white tracking-tight truncate">—</h3>
                        <p id="gh-modal-empresa" class="text-[10px] text-slate-400 font-bold uppercase tracking-widest mt-0.5 truncate">—</p>
                    </div>
                </div>
                <div class="flex items-center gap-2 shrink-0 ml-3">
                    <span id="gh-modal-badge" class="text-[9px] font-black px-3 py-1 rounded-full uppercase tracking-wider"></span>
                    <button onclick="cerrarDetalleHallazgo()"
                        class="w-8 h-8 rounded-lg bg-white/5 flex items-center justify-center text-slate-400 hover:bg-white/10 transition border border-white/10">
                        <span class="material-symbols-outlined text-base">close</span>
                    </button>
                </div>
            </div>

            <!-- Cuerpo scrollable -->
            <div class="overflow-y-auto flex-1 p-5 space-y-5">

                <!-- Fotos -->
                <div>
                    <!-- Foto simple (ABIERTO) -->
                    <div id="gh-modal-foto-simple" class="hidden space-y-1.5">
                        <p class="text-[9px] text-slate-500 font-black uppercase tracking-widest">Evidencia Fotográfica</p>
                        <img id="gh-modal-img-evidencia" src="" alt="Evidencia"
                            class="w-full rounded-xl border border-white/10 object-cover"
                            style="max-height:280px;"
                            onerror="this.style.display='none';document.getElementById('gh-modal-img-ev-ph').style.display='flex'">
                        <div id="gh-modal-img-ev-ph"
                            style="display:none;height:160px;"
                            class="w-full rounded-xl border border-white/10 bg-white/5 flex-col items-center justify-center gap-2 text-slate-500 text-xs">
                            <span class="material-symbols-outlined text-3xl">hide_image</span>
                            <span>Sin foto disponible</span>
                        </div>
                    </div>

                    <!-- Antes/Después (CERRADO) -->
                    <div id="gh-modal-foto-doble" class="hidden">
                        <p class="text-[9px] text-slate-500 font-black uppercase tracking-widest mb-2">Comparativa · Antes / Después</p>
                        <div class="grid grid-cols-2 gap-3">
                            <div class="space-y-1.5">
                                <div class="flex items-center gap-1.5">
                                    <span class="w-2 h-2 rounded-full bg-red-500 inline-block"></span>
                                    <p class="text-[9px] text-red-400 font-black uppercase tracking-widest">Evidencia</p>
                                </div>
                                <img id="gh-modal-img-antes" src="" alt="Antes"
                                    class="w-full rounded-xl border border-red-500/20 object-cover"
                                    style="height:175px;"
                                    onerror="this.style.display='none';this.nextElementSibling.style.display='flex'">
                                <div style="display:none;height:175px;"
                                    class="w-full rounded-xl border border-white/10 bg-white/5 flex-col items-center justify-center gap-1 text-slate-600 text-[10px]">
                                    <span class="material-symbols-outlined text-2xl">hide_image</span>Sin foto
                                </div>
                            </div>
                            <div class="space-y-1.5">
                                <div class="flex items-center gap-1.5">
                                    <span class="w-2 h-2 rounded-full bg-green-500 inline-block"></span>
                                    <p class="text-[9px] text-green-400 font-black uppercase tracking-widest">Cierre</p>
                                </div>
                                <img id="gh-modal-img-despues" src="" alt="Después"
                                    class="w-full rounded-xl border border-green-500/20 object-cover"
                                    style="height:175px;"
                                    onerror="this.style.display='none';this.nextElementSibling.style.display='flex'">
                                <div style="display:none;height:175px;"
                                    class="w-full rounded-xl border border-white/10 bg-white/5 flex-col items-center justify-center gap-1 text-slate-600 text-[10px]">
                                    <span class="material-symbols-outlined text-2xl">hide_image</span>Sin foto
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Línea de tiempo -->
                <div style="background:rgba(255,255,255,0.03);border-color:rgba(255,255,255,0.07);"
                    class="rounded-xl p-4 border space-y-3">
                    <p class="text-[9px] text-slate-500 font-black uppercase tracking-widest">Línea de Tiempo</p>
                    <div class="flex gap-3 items-start">
                        <div class="w-7 h-7 bg-red-500/15 rounded-lg flex items-center justify-center border border-red-500/20 shrink-0 mt-0.5">
                            <span class="material-symbols-outlined text-sm text-red-400">flag</span>
                        </div>
                        <div>
                            <p class="text-xs font-black text-white">Reportado</p>
                            <p id="gh-modal-fecha-reporte" class="text-[10px] text-slate-400 font-medium mt-0.5"></p>
                            <p id="gh-modal-supervisor" class="text-[10px] text-slate-400 font-medium"></p>
                        </div>
                    </div>
                    <div id="gh-modal-timeline-cierre" class="hidden gap-3 items-start">
                        <div class="w-7 h-7 bg-green-500/15 rounded-lg flex items-center justify-center border border-green-500/20 shrink-0 mt-0.5">
                            <span class="material-symbols-outlined text-sm text-green-400">task_alt</span>
                        </div>
                        <div>
                            <p class="text-xs font-black text-white">Cerrado</p>
                            <p id="gh-modal-fecha-cierre" class="text-[10px] text-slate-400 font-medium mt-0.5"></p>
                        </div>
                    </div>
                </div>

                <!-- Detalles -->
                <div class="space-y-2.5">
                    <p class="text-[9px] text-slate-500 font-black uppercase tracking-widest">Detalles del Hallazgo</p>
                    <div class="grid grid-cols-2 gap-2">
                        <div style="background:rgba(255,255,255,0.03);border-color:rgba(255,255,255,0.06);"
                            class="rounded-xl p-3 border">
                            <p class="text-[8px] text-slate-600 font-bold uppercase tracking-widest mb-1">Empresa</p>
                            <p id="gh-modal-empresa-det" class="text-xs font-bold text-white"></p>
                        </div>
                        <div style="background:rgba(255,255,255,0.03);border-color:rgba(255,255,255,0.06);"
                            class="rounded-xl p-3 border">
                            <p class="text-[8px] text-slate-600 font-bold uppercase tracking-widest mb-1">Reportado A</p>
                            <p id="gh-modal-reportado-a" class="text-xs font-bold text-white"></p>
                        </div>
                    </div>
                    <div style="background:rgba(255,255,255,0.03);border-color:rgba(255,255,255,0.06);"
                        class="rounded-xl p-3 border">
                        <p class="text-[8px] text-slate-600 font-bold uppercase tracking-widest mb-1">Ubicación</p>
                        <p id="gh-modal-ubicacion" class="text-xs text-slate-200"></p>
                    </div>
                    <div style="background:rgba(255,255,255,0.03);border-color:rgba(255,255,255,0.06);"
                        class="rounded-xl p-3 border">
                        <p class="text-[8px] text-slate-600 font-bold uppercase tracking-widest mb-1">Descripción del Hallazgo</p>
                        <p id="gh-modal-descripcion" class="text-xs text-slate-200 leading-relaxed"></p>
                    </div>
                </div>

                <!-- Gestión realizada -->
                <div id="gh-modal-gestion-box" class="hidden bg-green-500/5 border border-green-500/15 rounded-xl p-4 space-y-2">
                    <div class="flex items-center gap-2">
                        <span class="material-symbols-outlined text-base text-green-400">verified</span>
                        <p class="text-[9px] text-green-400/80 font-black uppercase tracking-widest">Gestión Realizada</p>
                    </div>
                    <p id="gh-modal-gestion" class="text-xs text-slate-200 leading-relaxed"></p>
                </div>

            </div>
        </div>
    </div>

</div><!-- /root -->
